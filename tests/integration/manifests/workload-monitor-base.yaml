---
# Test 10 - Base Workload Monitor Manifest
# This creates the initial workload resources

# Main workload namespace
apiVersion: v1
kind: Namespace
metadata:
  name: env-staging-abc123
  labels:
    app.kubernetes.io/name: test-workload-cluster
    workload-type: main
    test-scenario: workload-monitor-e2e
---
# App workload namespace
apiVersion: v1
kind: Namespace
metadata:
  name: env-staging-abc123-app
  labels:
    workload-type: app
    test-scenario: workload-monitor-e2e
---
# DB workload namespace
apiVersion: v1
kind: Namespace
metadata:
  name: env-staging-abc123-db
  labels:
    workload-type: db
    test-scenario: workload-monitor-e2e
---
# Main workload pod
apiVersion: v1
kind: Pod
metadata:
  name: main-workload-pod
  namespace: env-staging-abc123
  labels:
    app: workload-test
    component: main
spec:
  containers:
  - name: main-worker
    image: nginx:1.21
    ports:
    - containerPort: 80
    env:
    - name: WORKLOAD_ID
      value: "abc123"
    - name: COMPONENT
      value: "main"
---
# Main workload configmap
apiVersion: v1
kind: ConfigMap
metadata:
  name: main-workload-config
  namespace: env-staging-abc123
  labels:
    app: workload-test
    component: main
data:
  workload.yaml: |
    workload:
      id: abc123
      name: test-workload-cluster
      namespace: env-staging-abc123
      type: main